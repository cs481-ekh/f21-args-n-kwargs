{% extends 'equipment/base.html' %}
{% load static %}
{% block cssLinks %}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    {#    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">#}
    <link rel="stylesheet" type="text/css" href="{% static "dataTable/dataTable.css" %}">
{% endblock %}

{% block jsLinks %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    {#    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js" integrity="sha512-FHZVRMUW9FsXobt+ONiix6Z0tIkxvQfxtCSirkKc5Sb4TKHmqq1dZa8DphF0XqKb3ldLu/wgMa8mT6uXiLlRlw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>#}
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
{% endblock %}

{% block content %}
    <div class="container" style="margin: 5px; max-width: 90%;">
        <div class="row">
            <div id="filterContainer" class="col col-2">
                <hr>
                <h3 class="px-3">Filter</h3>
                <hr>
                <label class="filter-label mb-3 px-3">Locations</label>
                <ul id="locationList" class="px-3"> {# TODO: make this work with real data #}
                    <li>
                        <label class="check-options">
                            <input type="checkbox" name="location[]" value="Micron">
                            Micron
                        </label>
                    </li>
                    <li>
                        <label class="check-options">
                            <input type="checkbox" name="location[]" value="Boise State University">
                            Boise State University
                        </label>
                    </li>
                    <li>
                        <label class="check-options">
                            <input type="checkbox" name="location[]" value="ANML">
                            Category3
                        </label>
                    </li>
                    <li>
                        <label class="check-options">
                            <input type="checkbox" name="location[]" value="Place">
                            Misc
                        </label>
                    </li>
                </ul>
                <button type="button" class="apply-filters-button mx-3 mt-2 py-1 px-4" id="locationApplyFilters"
                        style="display: none;">Apply
                </button>
                <br>
                <hr>
                {% if categories %}
                    <label class="filter-label mb-3 px-3">Categories</label>
                    <ul id="categoryList" class="px-3">
                        {% for categoryId, categoryName in categories %}
                            <li>
                                <label class="check-options">
                                    <input type="checkbox" name="category[]" value="{{ categoryId }}">
                                    {{ categoryName }}
                                </label>
                            </li>
                        {% endfor %}
                    </ul>
                    <button type="button" class="apply-filters-button mx-3 mt-2 py-1 px-4" id="categoryApplyFilters"
                            style="display: none;">Apply
                    </button>
                {% endif %}
            </div>

            <div class="col col-1"></div>
            <div id="dataTableContainer" class="col col-9">
                {#                {% if show_controls %}#}
                {#                    {% csrf_token %}#}
                {#                                <button class="btn btn-success" id="addEquipmentButton" data-toggle="modal" data-target="#equipmentModal" style="margin-bottom: 5px">Add Item#}
                {#                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" style="" viewBox="0 0 16 16">#}
                {#                                        <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>#}
                {#                                    </svg>#}
                {#                                </button>#}
                {#                {% endif %}#}

                <table id="dataTable" class="hover cell-border order-column">
                    {# https://datatables.net/manual/styling/classes #}
                    <thead>
                    <tr>
                        <!-- This will have to be populated at some point with real data, but for now this is just demo data-->
                        <th>Equipment Name</th>
                        <th>Description</th>
                        <th>Location</th>
                        <th>Owner of Equipment</th>
                        <th>Categories</th>
                        {% if show_controls %}
                            <th>Controls</th>
                        {% endif %}
                    </tr>
                    </thead>
                    <tbody>

                    {% for equipment in data %}
                        <tr data-id= {{ equipment.id }}>
                            <td>{{ equipment.name }}</td>
                            <td>{{ equipment.model }}</td>
                            <td>{{ equipment.location }}</td>
                            <td>{{ equipment.name }}</td>
                            <td>{{ equipment.manfacturer }}</td>
                            {#                                <td>{{ equipment.permission }}</td>#}
                            {#                                <td>{{ equipment.id}}</td>#}
                            {% if show_controls %}
                                <td class="controls">
                                    <a class="editEquipmentButton control-button px-2" data-toggle="modal" data-target="#equipmentModal" data-id="toBeFilled">
                                        <i class="far fa-edit"></i>
                                    </a>
                                    <a class="removeEquipmentButton control-button px-2" data-id="{{ equipment.pk }}">
                                        <i class="far fa-trash-alt"></i>
                                    </a>

                                    {#                               <button class="btn btn-danger form-control" onClick="deleteUser({{equipment.pk}})">DELETE</button>#}
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="equipmentModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="equipmentModalTitle">Add/Edit Equipment</h5>
                </div>
                <div class="modal-body">
                    {{ form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                    <button class="save-button py-2 px-3" type="button" id="saveEquipmentButton" data-dismiss="modal">Save</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block inlineJS %}
    <script>
        $(function () {
            $('#dataTable').DataTable();
            $(".removeEquipmentButton").click(function () {
                let id = +$(".removeEquipmentButton").attr('data-id');
                let action = confirm("Are you sure you want to delete this item? ");
                if (action !== false) {
                    $.ajax({
                        url: '{% url "crud_delete" %}',
                        data: {'id': id,},
                        dataType: 'json',
                        success: function (data) {
                            if (data.deleted) {
                                setTimeout(function () {
                                    location.reload();
                                }, 1)
                            }
                        }
                    })
                }
            });
            $(".editEquipmentButton").click(function () {
                //Set some hidden id in the modal to the id in the data-id attribute
                //$(attributeToBeFilled).val($(this).attr('data-id'))
            });

            //This is in the modal
            $("#saveEquipmentButton").click(function () {
                /*
                *if(id > 0)
                * $.post('/editEquipment', {dataToBeFilled}, success, fail);
                * else
                * $.post('/saveEquipment', {dataToBeFilled}, success, fail);
                 */
            });
            $('.applyFilters').click(function () {
                let locations = checkboxesToArray("location[]");
                let categories = checkboxesToArray("category[]");
                console.log(categories);
                console.log(locations);
            });

            $('#locationList input').change(function () {
                if ($("#locationList input[type=checkbox]:checked").length > 0) {
                    $('#locationApplyFilters').show();
                } else if ($('#locationList input[type=checkbox]:checked').length == 0) {
                    $('#locationApplyFilters').hide();
                }
            });

            $('#categoryList input').change(function () {
                if ($("#categoryList input[type=checkbox]:checked").length > 0) {
                    $('#categoryApplyFilters').show();
                } else if ($('#categoryList input[type=checkbox]:checked').length == 0) {
                    $('#categoryApplyFilters').hide();
                }
            });

            function checkboxesToArray(nameOfCheckboxes) {
                let values = new Array();
                $.each($(`input[name='${nameOfCheckboxes}']:checked`), function () {
                    values.push($(this).val());
                });
                return values;
            }
        });
    </script>
{% endblock %}